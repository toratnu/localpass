# パスワード管理アプリ (LocalPass) - 仕様書

## 1. 概要

本アプリケーションは、ユーザーのパスワード情報をブラウザのローカルストレージに暗号化して安全に保管するWebアプリケーションです。サーバーサイドの処理を一切必要とせず、静的なHTML、CSS、JavaScriptファイルのみで動作します。これにより、ユーザーのパスワードデータが外部サーバーに送信されるリスクを排除し、プライバシーとセキュリティを最大限に保護します。

## 2. 機能

### 2.1. マスターパスワード管理
- **設定:** アプリケーション初回起動時、またはデータが削除された初期状態において、ユーザーはマスターパスワードを設定します。
- **ロック解除:** 設定済みのマスターパスワードを入力することで、保存されたパスワードデータにアクセスできます。
- **強度表示:** マスターパスワード設定時および変更時に、入力されたパスワードの強度（長さ、文字種など）をリアルタイムで視覚的に表示します。
- **変更:** ログイン後、現在のマスターパスワードと新しいマスターパスワードを入力することで、マスターパスワードを変更できます。データは新しいマスターパスワードで再暗号化されます。
- **自動ロック:** メイン画面から手動でロック画面に戻ることができます。
- **試行回数制限と自動削除:** マスターパスワードの入力に10回連続で失敗した場合、セキュリティのため、ローカルストレージに保存されている全てのデータが自動的に削除されます。試行回数はセッションストレージで管理され、ブラウザを閉じるとリセットされます。

### 2.2. パスワードデータの管理
- **保存:** サービス名、ユーザーID/メールアドレス、パスワードのセットを保存できます。パスワードはマスターパスワードで暗号化されてローカルストレージに保管されます。
- **表示:** 保存されたパスワードの一覧が表示されます。各パスワードはデフォルトで非表示となっており、「表示」ボタンをクリックすることで一時的に表示されます。
- **検索:** サービス名に基づいて保存されているパスワードをリアルタイムで検索・フィルタリングできます。
- **コピー:** 各パスワード項目に設置された「コピー」ボタンをクリックすることで、該当パスワードをクリップボードにコピーできます。
- **削除:** 各パスワード項目に設置された「削除」ボタンをクリックすることで、確認ダイアログを経て、該当パスワードを削除できます。
- **全データ削除:** ロック画面に「全データを完全に削除」ボタンがあり、ユーザーが意図的に全ての保存データをローカルストレージから消去できます。この操作は不可逆です。

## 3. 技術スタック

- **フロントエンド:** HTML5, CSS3, JavaScript (ES6+)
- **暗号化:** Web Crypto API
  - **鍵導出:** PBKDF2 (Password-Based Key Derivation Function 2) - マスターパスワードから暗号化キーを安全に導出します。
  - **暗号化アルゴリズム:** AES-GCM (Advanced Encryption Standard - Galois/Counter Mode) - データの暗号化・復号に使用される認証付き暗号化モードです。
- **データ永続化:** `localStorage` API - 暗号化されたパスワードデータをブラウザに永続的に保存します。
- **一時データ管理:** `sessionStorage` API - マスターパスワードの試行回数など、セッションに紐づく一時的なデータを管理します。

## 4. セキュリティに関する考慮事項

- **クライアントサイド完結:** 全ての処理がユーザーのブラウザ内で完結するため、パスワードデータがネットワークを介して外部に送信されることはありません。
- **マスターパスワードの重要性:** マスターパスワードは、全ての暗号化されたデータにアクセスするための唯一の鍵です。アプリケーションはマスターパスワードを保存しないため、紛失した場合、データの復旧は不可能です。
- **強力な暗号化:** 業界標準のPBKDF2とAES-GCMを使用することで、ブルートフォース攻撃や辞書攻撃に対する耐性を高めています。
- **自動データ削除:** 連続した不正なマスターパスワード入力に対する防御策として、自動データ削除機能を実装しています。

## 5. UI/UXに関する考慮事項

- **モダンなデザイン:** ガラスモフィズムを取り入れた、視覚的に魅力的でモダンなインターフェースを提供します。
- **直感的なインターフェース:** シンプルで分かりやすい画面構成と操作フローを提供します。
- **レスポンシブデザイン:** モバイルデバイスからデスクトップまで、様々な画面サイズに最適化された表示と操作性を提供します。
- **リアルタイムフィードバック:** パスワード強度インジケーターや検索結果のリアルタイム更新により、ユーザーに即座のフィードバックを提供します。
- **エラーメッセージ:** マスターパスワードの誤入力時には、ポップアップではなく画面上のラベルで残り試行回数を含むエラーメッセージを表示し、ユーザー体験を損ないません。
- **折りたたみ可能なセクション:** 初めてのユーザー向けの案内や使い方ガイドなど、情報量の多いセクションを折りたたみ可能にし、画面の整理とユーザーの集中を促します。
- **モーダルウィンドウ:** パスワードの追加やマスターパスワードの変更など、特定の操作にはモーダルウィンドウを使用し、ユーザーの注意を集中させ、操作フローを明確にします。

## 6. ディレクトリ構成

```
/
├── index.html          # アプリケーションのメインHTMLファイル
├── README.md           # アプリケーションの概要と利用方法
├── SPEC.md             # 本仕様書
├── css/
│   └── style.css       # アプリケーションのスタイルシート
└── js/
    ├── main.js         # アプリケーションの主要なJavaScriptロジック（DOM操作、イベントハンドリングなど）
    └── lib/
        └── crypto.js   # 暗号化・復号処理を担うJavaScriptライブラリ
```

## 7. 制限事項と注意点

- **ブラウザストレージの特性:** `localStorage` はブラウザの機能に依存するため、ブラウザのキャッシュクリア、ブラウザの再インストール、異なるブラウザの使用などによりデータが失われる可能性があります。重要なパスワードは別途バックアップを取ることを強く推奨します。
- **マスターパスワードの管理:** マスターパスワードを忘れた場合、いかなる方法でもデータの復旧はできません。安全な場所にメモするなど、厳重に管理してください。
- **物理的なセキュリティ:** アプリケーション自体は安全ですが、デバイスが物理的に不正アクセスされた場合、ローカルストレージのデータが危険に晒される可能性があります。デバイス自体のセキュリティ対策も重要です。
